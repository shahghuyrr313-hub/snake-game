<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Game Pro</title>

<style>
body{
    margin:0;
    text-align:center;
    font-family:Arial;
    background:#111;
    color:white;
}

canvas{
    background:white;
    display:block;
    margin:20px auto;
    border:3px solid black;
}

button{
    padding:10px 20px;
    font-size:16px;
    margin:5px;
    cursor:pointer;
}

#mobileControls button{
    font-size:22px;
    width:60px;
    height:60px;
}
</style>
</head>

<body>

<h1>Snake Game Pro</h1>
<h2 id="score">Score: 0 | Level: 1</h2>
<button onclick="startGame()">Start Game</button>

<canvas id="gameCanvas" width="400" height="400"></canvas>

<div id="mobileControls">
    <div>
        <button onclick="move('up')">⬆️</button>
    </div>
    <div>
        <button onclick="move('left')">⬅️</button>
        <button onclick="move('down')">⬇️</button>
        <button onclick="move('right')">➡️</button>
    </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const gridSize = 20;
const tileCount = canvas.width / gridSize;

let snake, food, obstacles;
let dx, dy, score, level, speed;
let gameInterval;

// SOUND EFFECTS (Note: External URLs may not work due to CORS; consider hosting locally or using free alternatives)
const eatSound = new Audio("https://www.soundjay.com/button/sounds/button-3.mp3");
const gameOverSound = new Audio("https://www.soundjay.com/misc/sounds/fail-buzzer-02.mp3");
const startSound = new Audio("https://www.soundjay.com/button/sounds/button-16.mp3");

function startGame(){
    startSound.play();

    snake = [{x:10,y:10}];
    food = getSafePosition();
    obstacles = [];
    dx = 0; // Start with no movement to prevent instant collision
    dy = 0;
    score = 0;
    level = 1;
    speed = 150;

    document.getElementById("score").innerText =
    "Score: 0 | Level: 1";

    clearInterval(gameInterval);
    gameInterval = setInterval(gameLoop, speed);
}

function gameLoop(){
    updateGame();
    drawGame();
}

function updateGame(){
    // Only update if moving
    if (dx === 0 && dy === 0) return;

    const head = {x: snake[0].x + dx, y: snake[0].y + dy};
    snake.unshift(head);

    if(head.x === food.x && head.y === food.y){
        score++;
        eatSound.play();

        if(score % 5 === 0){
            level++;
            speed = Math.max(50, speed - 15); // Prevent speed from going below 50ms
            addObstacle();
            clearInterval(gameInterval);
            gameInterval = setInterval(gameLoop, speed);
        }

        document.getElementById("score").innerText =
        "Score: " + score + " | Level: " + level;

        food = getSafePosition();
    } else {
        snake.pop();
    }

    // Wall collision
    if(head.x < 0 || head.x >= tileCount ||
       head.y < 0 || head.y >= tileCount){
        gameOver();
    }

    // Self collision
    for(let i=1;i<snake.length;i++){
        if(head.x === snake[i].x && head.y === snake[i].y){
            gameOver();
        }
    }

    // Obstacle collision
    obstacles.forEach(obs=>{
        if(head.x === obs.x && head.y === obs.y){
            gameOver();
        }
    });
}

function drawGame(){
    ctx.fillStyle="white";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle="green";
    snake.forEach(part=>{
        ctx.fillRect(part.x*gridSize,
                     part.y*gridSize,
                     gridSize-2,
                     gridSize-2);
    });

    ctx.fillStyle="red";
    ctx.fillRect(food.x*gridSize,
                 food.y*gridSize,
                 gridSize-2,
                 gridSize-2);

    ctx.fillStyle="black";
    obstacles.forEach(obs=>{
        ctx.fillRect(obs.x*gridSize,
                     obs.y*gridSize,
                     gridSize-2,
                     gridSize-2);
    });
}

function randomPosition(){
    return {
        x: Math.floor(Math.random()*tileCount),
        y: Math.floor(Math.random()*tileCount)
    };
}

function getSafePosition(){
    let pos;
    do {
        pos = randomPosition();
    } while (
        snake.some(segment => segment.x === pos.x && segment.y === pos.y) ||
        obstacles.some(obs => obs.x === pos.x && obs.y === pos.y) ||
        (food && food.x === pos.x && food.y === pos.y) // Avoid overlapping with existing food
    );
    return pos;
}

function addObstacle(){
    obstacles.push(getSafePosition());
}

function gameOver(){
    gameOverSound.play();
    alert("Game Over! Score: " + score + " | Level: " + level);
    clearInterval(gameInterval);
    // Optionally reset or show restart option
}

// Desktop controls
document.addEventListener("keydown", function(e){
    if(e.keyCode===37 && dx!==1){ dx=-1; dy=0; }
    if(e.keyCode===38 && dy!==1){ dx=0; dy=-1; }
    if(e.keyCode===39 && dx!==-1){ dx=1; dy=0; }
    if(e.keyCode===40 && dy!==-1){ dx=0; dy=1; }
});

// Mobile controls
function move(direction){
    if(direction==='up' && dy!==1){ dx=0; dy=-1; }
    if(direction==='down' && dy!==-1){ dx=0; dy=1; }
    if(direction==='left' && dx!==1){ dx=-1; dy=0; }
    if(direction==='right' && dx!==-1){ dx=1; dy=0; }
}
</script>

</body>
</html>
